(()=>{"use strict";var e=document.querySelector("#popup_edit-profile"),t=document.querySelector(".profile__button-edit"),n=document.querySelector(".profile__button-add"),o=document.querySelector("#popup__form_edit"),r=document.querySelector("#popup__form_add"),a=document.querySelector(".profile__name"),c=document.querySelector("#name-input"),u=document.querySelector(".profile__description"),i=document.querySelector("#description-input"),s=r.querySelector("#nameImage-input"),l=r.querySelector("#link-input"),d=document.querySelector("#popup_add-element"),p=document.querySelector(".popup_fullscreen"),m=document.querySelector(".popup__fullscreen-image"),f=document.querySelector(".popup__fullscreen-caption"),_=document.querySelector("#elements-template").content,v=document.querySelector(".element"),h=document.querySelector(".profile__avatar-container"),y=document.querySelector("#popup_change-avatar"),S=document.querySelector(".profile__avatar"),b=document.querySelector("#avatar-input"),q=document.querySelector("#popup__form_avatar"),C=document.querySelector("#button-save"),E=document.querySelector("#button-create"),L=document.querySelector("#button-save-avatar"),g={baseUrl:"https://nomoreparties.co/v1/plus-cohort-16",headers:{authorization:"bd20a1a7-783a-4ce0-8a79-cdcaf6dff26d","Content-Type":"application/json"}};function k(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var x=function(e,t){e.textContent=t.length},T=function(e){e.classList.toggle("element_button-like_active")};function U(e,t,n,o,r,a){var c=_.querySelector(".element__item").cloneNode(!0),u=c.querySelector(".element__image"),i=c.querySelector(".element__name"),s=c.querySelector(".element__button-like-count"),l=c.querySelector(".element__button-like"),d=c.querySelector(".element__button-trash");return i.textContent=e,u.src=t,u.alt=e,s.textContent=o.length,u.addEventListener("click",(function(){f.textContent=e,m.alt=e,m.src=t,w(p)})),o.some((function(e){a===e._id&&l.classList.add("element_button-like_active")})),l.addEventListener("click",(function(e){e.target.classList.contains("element_button-like_active")?function(e){return fetch("".concat(g.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:g.headers}).then(k)}(n).then((function(e){T(l),x(s,e.likes)})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(g.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:g.headers}).then(k)}(n).then((function(e){T(l),x(s,e.likes)})).catch((function(e){console.log(e)}))})),a===r?d.addEventListener("click",(function(e){(function(e){return fetch("".concat(g.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:g.headers}).then(k)})(n).then((function(){!function(e){e.target.closest(".element__item").remove()}(e)})).catch((function(e){console.log(e)}))})):d.remove(),c}function w(e){e.classList.add("popup_opened"),document.addEventListener("keydown",P),document.addEventListener("mousedown",B)}function A(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",P),document.removeEventListener("mousedown",B)}function P(e){"Escape"===e.key&&A(document.querySelector(".popup_opened"))}function B(e){(e.target.classList.contains("popup_opened")||e.target.classList.contains("popup__button-close"))&&A(e.target.closest(".popup_opened"))}var D,N=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)};Promise.all([fetch("".concat(g.baseUrl,"/users/me"),{method:"GET",headers:{authorization:g.headers.authorization}}).then(k),fetch("".concat(g.baseUrl,"/cards"),{method:"GET",headers:g.headers}).then(k)]).then((function(e){var t=e[0]._id;a.textContent=e[0].name,u.textContent=e[0].about,S.src=e[0].avatar,S.alt="User avatar: ".concat(e[0].name),e[1].forEach((function(e){v.append(U(e.name,e.link,e._id,e.likes,e.owner._id,t))}))})),t.addEventListener("click",(function(){c.value=a.textContent,i.value=u.textContent,w(e)})),n.addEventListener("click",(function(){w(d)})),h.addEventListener("click",(function(){w(y)})),o.addEventListener("submit",(function(t){var n,o;t.preventDefault(),C.textContent=C.dataset.onload,(n=c.value,o=i.value,fetch("".concat(g.baseUrl,"/users/me"),{method:"PATCH",headers:g.headers,body:JSON.stringify({name:n,about:o})}).then(k)).then((function(t){a.textContent=t.name,u.textContent=t.about,A(e)})).catch((function(e){console.log(e)})).finally((function(){C.textContent=C.dataset.default}))})),r.addEventListener("submit",(function(){var e,t;E.textContent=E.dataset.onload,(e=s.value,t=l.value,fetch("".concat(g.baseUrl,"/cards"),{method:"POST",headers:g.headers,body:JSON.stringify({name:e,link:t})}).then(k)).then((function(e){var t=U(e.name,e.link,e._id,e.likes,e.owner._id,userId);v.prepend(t),evt.target.reset(),A(d)})).catch((function(e){console.log(e)})).finally((function(){E.textContent=E.dataset.default,setTimeout((function(){window.location.reload()}))}))})),q.addEventListener("submit",(function(e){var t;e.preventDefault(),L.textContent=L.dataset.onload,(t=b.value,fetch("".concat(g.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:g.headers,body:JSON.stringify({avatar:t})}).then(k)).then((function(t){S.src=t.avatar,e.target.reset(),A(y)})).catch((function(e){console.log(e)})).finally((function(){L.textContent=L.dataset.default}))})),D={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button-save",inactiveButtonClass:"popup__button-save_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},Array.from(document.querySelectorAll(D.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);e.addEventListener("reset",(function(){setTimeout((function(){N(n,o,t)}),0)})),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.classList.add(o.errorClass),r.textContent=n}(e,t,t.validationMessage,n)}(e,r,t),N(n,o,t)}))}))}(e,D)}))})();